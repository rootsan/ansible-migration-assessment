[defaults]
# --- INVENTARIO Y ROLES ---
inventory      = ./inventory
roles_path     = ./roles
library        = ./library  ; Si usas módulos custom de Python

# --- RENDIMIENTO Y EJECUCIÓN ---
forks          = 20         ; Aumenta el paralelismo (default es 5). Ajusta según tu CPU.
poll_interval  = 5          ; Reduce la frecuencia de sondeo para tareas largas.
gathering      = smart      ; Solo recolecta facts si no los tiene en caché.
fact_caching   = jsonfile   ; Guarda los facts en disco para no re-escanear siempre.
fact_caching_connection = /tmp/.ansible_fact_cache
fact_caching_timeout = 7200 ; 2 horas de caché (ideal para no repetir 'setup' en cada prueba).

# --- SEGURIDAD Y CONEXIÓN ---
host_key_checking = False   ; CRÍTICO para migraciones masivas donde las fingerprints cambian.
timeout = 60                ; Sube el timeout (default 10s) para servidores lentos o saturados.
remote_user = automation    ; Usuario estándar de automatización (cámbialo al tuyo).

# --- VISUALIZACIÓN Y LOGS ---
# Usa 'yaml' para leer mejor los outputs complejos (como los JSONs de Leapp)
stdout_callback = yaml
# Habilita tiempos de ejecución para detectar qué tareas son cuellos de botella
callbacks_enabled = timer, profile_tasks, profile_roles
log_path = ./ansible_migration.log ; Guarda un historial de ejecución.

# --- GESTIÓN DE ERRORES ---
# Crea archivos .retry si algo falla, útil para re-ejecutar solo en los fallidos
retry_files_enabled = True
retry_files_save_path = ./.retries

[privilege_escalation]
become = True
become_method = sudo
become_user = root
become_ask_pass = False

[ssh_connection]
# --- OPTIMIZACIÓN SSH (PIPELINING) ---
# Pipelining acelera BRUTALMENTE la ejecución al reducir conexiones SSH.
# Requisito: 'requiretty' debe estar desactivado en /etc/sudoers de los clientes.
pipelining = True

# Persistencia de conexiones para velocidad (Multiplexing)
ssh_args = -o ControlMaster=auto -o ControlPersist=600s -o PreferredAuthentications=publickey
control_path = /tmp/ansible-ssh-%%h-%%p-%%r

# Transferencia de archivos más rápida
transfer_method = smart
